<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <title>자동차 마커 표시하기</title>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=vt8dqq5pyc"></script>
    <style>
        #car-info-modal {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            box-shadow: 0 4px 24px rgba(0,0,0,0.25);
            border-radius: 16px;
            padding: 32px 28px 32px 28px;
            z-index: 1000;
            min-width: 260px;
            min-height: 180px;
            transition: opacity 0.2s;
        }
        #car-info-modal.active {
            display: block;
            animation: popupFadeIn 0.2s;
        }
        @keyframes popupFadeIn {
            from { opacity: 0; transform: translate(-50%, -40%);}
            to { opacity: 1; transform: translate(-50%, -50%);}
        }
        #car-info-modal .car-img {
            width: 80px;
            height: 48px;
            object-fit: contain;
            margin-bottom: 12px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        #car-info-modal .close-btn {
            position: absolute;
            right: 20px;
            top: 16px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        #car-info-modal .car-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
        }
        #car-info-modal .car-detail {
            font-size: 16px;
            margin-bottom: 4px;
            text-align: center;
        }
    </style>
</head>
<body>
<div id="map" style="width:100%;height:400px;"></div>

<!-- 차량 정보 모달 -->
<div id="car-info-modal">
    <button class="close-btn" onclick="closeCarInfoModal()">×</button>
    <img class="car-img" id="car-img" src="" alt="car image">
    <div class="car-name" id="car-name"></div>
    <div class="car-detail" id="car-battery"></div>
    <div class="car-detail" id="car-range"></div>
</div>

<script>
// 차량별 임시 이미지 매핑 (없으면 기본 이미지)
const carImages = {
    "현대 아이오닉 5": "https://cdn.autodaily.co.kr/news/photo/202308/46301_63313_3939.jpg",
    "기아 EV6": "https://img.danawa.com/prod_img/500000/792/684/img/6684792_1.jpg",
    "테슬라 모델 3": "https://file3.carreview.kr/2023/09/13/1694579821_41.jpg",
    "쉐보레 볼트 EV": "https://cdn.motorgraph.com/news/photo/202308/31813_93438_4827.jpg",
    "르노 조에": "https://cdn.autodaily.co.kr/news/photo/202306/45344_61813_3242.jpg",
    "포르쉐 타이칸": "https://cdn.motorgraph.com/news/photo/202309/31913_93638_4827.jpg",
    "벤츠 EQC": "https://img.danawa.com/prod_img/500000/792/684/img/6684792_2.jpg",
    "BMW i4": "https://cdn.motorgraph.com/news/photo/202308/31813_93439_4827.jpg",
    "아우디 e-tron": "https://cdn.motorgraph.com/news/photo/202308/31813_93440_4827.jpg",
    "제네시스 GV60": "https://cdn.motorgraph.com/news/photo/202308/31813_93441_4827.jpg"
};
const defaultCarImg = "https://ssl.pstatic.net/static/maps/mantle/1x/marker-car.png";

// 자동차 아이콘 이미지 (네이버 기본 아이콘 예시)
var carIcon = {
    url: 'https://ssl.pstatic.net/static/maps/mantle/1x/marker-car.png',
    size: new naver.maps.Size(32, 32),
    origin: new naver.maps.Point(0, 0),
    anchor: new naver.maps.Point(16, 16)
};

// 차량 정보 모달 표시 함수
function showCarInfoModal(car) {
    document.getElementById('car-img').src = carImages[car.name] || defaultCarImg;
    document.getElementById('car-name').textContent = car.name;
    document.getElementById('car-battery').textContent = `배터리: ${car.battery}%`;
    document.getElementById('car-range').textContent = `주행 가능 거리: ${car.range} km`;
    document.getElementById('car-info-modal').classList.add('active');
}

// 차량 정보 모달 닫기 함수
function closeCarInfoModal() {
    document.getElementById('car-info-modal').classList.remove('active');
}

// 서버에서 데이터 받아와서 지도에 마커 표시
fetch('https://seoul-locations.onrender.com/locations')
    .then(response => response.json())
    .then(data => {
        if (!data.locations || data.locations.length === 0) {
            alert('서버에서 위치 정보를 받아오지 못했습니다.');
            return;
        }

        // 지도 중심을 첫 번째 좌표로 설정
        var center = new naver.maps.LatLng(data.locations[0].lat, data.locations[0].lng);
        var map = new naver.maps.Map('map', {
            center: center,
            zoom: 12
        });

        // 각 좌표에 자동차 마커 표시 및 클릭 이벤트
        data.locations.forEach(function(car, idx) {
            var marker = new naver.maps.Marker({
                position: new naver.maps.LatLng(car.lat, car.lng),
                map: map,
                icon: carIcon,
                title: car.name
            });

            naver.maps.Event.addListener(marker, "click", function() {
                showCarInfoModal(car);
            });
        });
    })
    .catch(error => {
        alert('위치 정보를 불러오는 중 오류가 발생했습니다.');
        console.error('fetch 에러:', error);
    });

// 모달 바깥 클릭 시 닫기 (팝업 중앙이므로 배경 클릭 시 닫기)
window.addEventListener('mousedown', function(e) {
    const modal = document.getElementById('car-info-modal');
    if (modal.classList.contains('active') && !modal.contains(e.target) && e.target.className !== 'close-btn') {
        closeCarInfoModal();
    }
});
</script>
</body>
</html>